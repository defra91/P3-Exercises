package Rimbalzi.gui;
import java.awt.Color;
import javax.swing.*;
import java.awt.*;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;

/** Questa classe rappresenta l'ambiente su cui si muovono le palline. Estende il concetto di pannello come interfaccia grafica ed implementa i thread per l'esecuzione in parallelo.
 * @author Luca De Franceschi
 * @version 1.0, Ven 8 Nov 2013
 *
 */
public class Environment extends JPanel implements Runnable {
	/**
	 * 
	 */
	/**
	 * 
	 */
	private Ball balls[]; 
	/**
	 * 
	 */
	/**
	 * 
	 */
	private double gravity;
	/**
	 * 
	 */
	/**
	 * 
	 */
	private double windVelX;
	/**
	 * 
	 */
	/**
	 * 
	 */
	private double windVelY;
	/**
	 * 
	 */
	/**
	 * 
	 */
	private Color backgroundColor;

	/**
	 * @param b
	 * @param g
	 * @param wx
	 * @param wy
	 * @param bg
	 */
	/**
	 * @param b
	 * @param g
	 * @param wx
	 * @param wy
	 * @param bg
	 */
	public Environment(Ball[] b, double g, double wx, double wy, Color bg) {
		balls = b;
		gravity = g;
		windVelX = wx; windVelY = wy;
		backgroundColor = bg;
		setBackground(bg);
		
		addMouseListener(new MouseListener() {
			public void mouseClicked(MouseEvent e) {
				Point p = e.getPoint();
				double x = p.getX(); double y = p.getY();
				for (Ball b : balls) {
					if ((x > b.getX() && x < (b.getX()+b.getWidth())) && (y > b.getY() && y < (b.getY()+b.getHeight()))) {
						b.setFrame(0,0,0,0);
						
					}
				}
				paint(getGraphics());
			}

			@Override
			public void mouseEntered(MouseEvent e) {}

			@Override
			public void mouseExited(MouseEvent e) {}

			@Override
			public void mousePressed(MouseEvent e) {}

			@Override
			public void mouseReleased(MouseEvent e) {}
		});
	}
	
	/* Definizione dei metodi getter e setter */
	
	/**
	 * @return
	 */
	/**
	 * @return
	 */
	public Ball[] getBalls() {
		return balls;
	}
	/**
	 * @param b
	 */
	/**
	 * @param b
	 */
	public void setBalls(Ball b[]) {
		this.balls = b;
	}
	/**
	 * @return
	 */
	/**
	 * @return
	 */
	public double getGravity() {
		return gravity;
	}
	/**
	 * @param gravity
	 */
	/**
	 * @param gravity
	 */
	public void setGravity(double gravity) {
		this.gravity = gravity;
	}
	/**
	 * @return
	 */
	/**
	 * @return
	 */
	public double getWindoVelY() {
		return windVelY;
	}
	/**
	 * @param windoVelY
	 */
	/**
	 * @param windoVelY
	 */
	public void setWindoVelY(double windoVelY) {
		this.windVelY = windoVelY;
	}
	/**
	 * @return
	 */
	/**
	 * @return
	 */
	public double getWindVelX() {
		return windVelX;
	}
	/**
	 * @param windVelX
	 */
	/**
	 * @param windVelX
	 */
	public void setWindVelX(double windVelX) {
		this.windVelX = windVelX;
	}
	/**
	 * @return
	 */
	/**
	 * @return
	 */
	public Color getBackgroundColor() {
		return backgroundColor;
	}
	/**
	 * @param backgroundColor
	 */
	/**
	 * @param backgroundColor
	 */
	public void setBackgroundColor(Color backgroundColor) {
		this.backgroundColor = backgroundColor;
	}
	
	/* (non-Javadoc)
	 * @see javax.swing.JComponent#paintComponent(java.awt.Graphics)
	 */
	/* (non-Javadoc)
	 * @see javax.swing.JComponent#paintComponent(java.awt.Graphics)
	 */
	public void paintComponent(Graphics g) {
		super.paintComponent(g);
		Graphics2D g2 = (Graphics2D) g;
		for (Ball b : balls) {
			g2.fill(b);
			g2.setColor(b.getBackgroundColor());
		}	
	}
	
	/* (non-Javadoc)
	 * @see java.lang.Runnable#run()
	 */
	/* (non-Javadoc)
	 * @see java.lang.Runnable#run()
	 */
	public void run() {
		try {
			while (!Thread.currentThread().isInterrupted()) {
				for (int i=0; ; i++) {
					for (Ball b : balls) {
						b.move(getBounds());
					}
					paint(getGraphics());
					Thread.sleep(3);
				}
			}
		} 
		catch(InterruptedException e) { 
			System.out.println("Thread interrotto durante l'esecuzione"); 
		}
		finally {
			
		}
	}
}
